"use strict";(()=>{var e={};e.id=853,e.ids=[853],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6985:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>f,patchFetch:()=>T,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var n={};o.r(n),o.d(n,{POST:()=>u});var s=o(9303),r=o(8716),a=o(670),i=o(7070);let p=new Map,l=new Map,d="5713148911";async function u(e){try{let t=e.ip||e.headers.get("x-forwarded-for")||"unknown";if(!function(e){let t=Date.now(),o=`rate_limit_${e}`,n=l.get(o);return!n||t>n.resetTime?(l.set(o,{count:1,resetTime:t+3e5}),!0):!(n.count>=3)&&(n.count++,!0)}(t))return i.NextResponse.json({error:"Too many requests. Please try again in 5 minutes."},{status:429});let o=Math.floor(1e4+9e4*Math.random()).toString(),n=Date.now()+6e5,s=`otp_${t}`;p.set(s,{otp:o,expires:n,attempts:0});let r=!1,a="";try{(await fetch("https://api.whatsapp.com/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:`+1${d}`,text:`Your Fifi Hair Salon admin login OTP is: ${o}. This code expires in 10 minutes.`})})).ok&&(r=!0)}catch(e){console.log("WhatsApp API failed:",e),a="WhatsApp service unavailable"}if(!r)try{(await fetch("https://api.sms-magic.com/api/v1/send",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer test"},body:JSON.stringify({to:`+1${d}`,message:`Your Fifi Hair Salon admin login OTP is: ${o}. This code expires in 10 minutes.`})})).ok&&(r=!0)}catch(e){console.log("SMS service failed:",e),a="SMS services unavailable"}if(!r)return console.log(`
🔐 ADMIN OTP GENERATED:`),console.log(`📱 Phone: +1${d}`),console.log(`🔑 OTP Code: ${o}`),console.log(`⏰ Expires: 10 minutes`),console.log(`
💡 To test: Go to http://localhost:3001/admin-verify and enter: ${o}`),console.log(`
📧 For real SMS: Contact developer to set up SMS service
`),i.NextResponse.json({message:`OTP generated! Check terminal for code: ${o}`,devOtp:o,instructions:"Enter the OTP from your terminal to continue",smsError:a});return i.NextResponse.json({message:"OTP sent successfully"})}catch(e){return console.error("Error sending OTP:",e),i.NextResponse.json({error:"Failed to send OTP. Please try again."},{status:500})}}process.env.TEXTBELT_API_KEY;let c=new s.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/admin/send-otp/route",pathname:"/api/admin/send-otp",filename:"route",bundlePath:"app/api/admin/send-otp/route"},resolvedPagePath:"/Users/surafellemma/Desktop/Fifi Hair Salon/app/api/admin/send-otp/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:g}=c,f="/api/admin/send-otp/route";function T(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),n=t.X(0,[948,972],()=>o(6985));module.exports=n})();